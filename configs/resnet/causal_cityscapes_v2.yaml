# configs/resnet/causal_cityscapes_v14_clean_feature.yaml
# V14 策略：加强解耦 (Indep=0.5) + 加强重构 (Recon=2.0)
# 假设 Abs Err 的瓶颈在于特征不纯，通过清洗特征来提升泛化能力

data:
  type: "cityscapes"
  dataset_path: "/data/chengfengwu/alrl/mtl_dataset/cityscape_preprocess"
  batch_size: 16
  num_workers: 4
  img_size: [128, 256]
  pin_memory: True

model:
  type: "causal"
  encoder_name: "resnet50"
  pretrained: True
  latent_dim_s: 128
  latent_dim_p: 256
  z_s_bottleneck_noise: 0.1
  num_scene_classes: 1
  num_seg_classes: 7
  gating_scale_cap: 0.3
  decomposition:
    enabled: true
    normal_head_hidden: 128
    albedo_head_hidden: 128
    light_head:
      sh_degree: 2
      grayscale_prior: true

training:
  seed: 888
  epochs: 100
  optimizer: "Adam"
  learning_rate: 0.0001
  weight_decay: 0.00001
  enable_training: True

  stage1_epochs: 30       # 延长预热
  ind_warmup_epochs: 30

  lr_scheduler:
    type: "cosine"
    warmup_epochs: 5
    min_lr_factor: 0.01

losses:
  # 1. 任务损失 (适中)
  lambda_seg: 10.0        # 保持标准
  lambda_depth: 20.0      # [HIGH] 依然给高权重，但不如 V13 激进
  lambda_normal: 0.0
  lambda_scene: 0.0

  # 2. 因果约束 (加强)
  lambda_independence: 1.0 # [BOOST] 强迫 CKA 下降，清洗特征

  # 3. 重构损失 (加强)
  alpha_recon_geom: 2.0   # [BOOST] 确保 zs 包含足够几何信息
  beta_recon_app: 2.0     # [BOOST] 确保 zp 包含足够纹理信息
  lambda_l1_recon: 1.0

  # 4. 辅助
  alpha_recon_geom_aux: 0.5
  beta_recon_app_aux: 0.5
  lambda_depth_zp: 0.5

  # 5. 分解正则
  lambda_img: 2.0         # [BOOST] 恢复一定的画图能力，辅助解耦
  lambda_alb_tv: 0.01
  lambda_alb_chroma: 0.01
  lambda_sh_gray: 0.1
  lambda_norm: 0.1
  lambda_xcov: 0.05