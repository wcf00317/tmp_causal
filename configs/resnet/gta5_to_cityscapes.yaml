# configs/gta5_to_cityscapes.yaml

# -- Data Parameters --
data:
  type: "gta5_to_cityscapes"
  # 请修改为您实际的路径
  train_dataset_path: "/data/chengfengwu/alrl/mtl_dataset/gta5/train"

    # 2. 目标域验证集 (Cityscapes Val) - 用于选最佳模型
  val_dataset_path: "/data/chengfengwu/alrl/mtl_dataset/cityscape_preprocess"

    # 3. ★新增★: 源域验证集 (GTA5 Val) - 用于填表第一列
  source_val_path: "/data/chengfengwu/alrl/mtl_dataset/gta5/val"

  batch_size: 8
  num_workers: 4
  img_size: [256, 128]
  pin_memory: True

# -- Model Parameters --
model:
  type: "causal"         # 或者 "single_task" 用于做 Baseline 对比
  encoder_name: "resnet50"
  pretrained: True
  latent_dim_s: 128
  latent_dim_p: 256
  z_s_bottleneck_noise: 0.1
  num_scene_classes: 1   # GTA5 和 Cityscapes 都没有场景分类标签
  gating_scale_cap: 0.3
  num_seg_classes: 7

  decomposition:
    enabled: true
    normal_head_hidden: 128
    albedo_head_hidden: 128
    light_head:
      sh_degree: 2
      grayscale_prior: true

# -- Training Parameters --
training:
  seed: 42
  epochs: 200             # Sim-to-Real 通常需要较多 Epoch
  optimizer: "AdamW"
  learning_rate: 0.00005 # 略微降低 LR 以防过拟合合成域
  weight_decay: 0.01
  enable_training: True

  stage1_epochs: 20
  ind_warmup_epochs: 20

  lr_scheduler:
    type: cosine
    warmup_epochs: 3
    min_lr_factor: 0.1

# -- Loss Weights --
losses:
  # === 关键设置 ===
  lambda_seg: 10.0      # 主攻分割
  lambda_depth: 0.0     # GTA5 没有深度真值，关闭深度监督
  lambda_scene: 0.0     # 关闭场景分类

  # === 独立性约束 (尝试通过解耦提高泛化性) ===
  lambda_independence: 1.0

  # === 重构 (无深度真值，仅保留外观重构) ===
  alpha_recon_geom: 0.0      # 没深度真值，无法监督几何重构
  beta_recon_app: 3.0        # 此时外观重构变得非常重要(无监督域适应的常用手段)
  lambda_l1_recon: 3.0

  alpha_recon_geom_aux: 0.0
  beta_recon_app_aux: 2.5
  lambda_depth_zp: 0.0

  # === 边缘一致性 (全关，因为没深度) ===
  lambda_depth_edge_weight_alpha: 0.0
  lambda_depth_edge_weight_q: 0.0
  lambda_depth_edge_weight_mix: 0.0
  lambda_edge_consistency: 0.0
  alpha_recon_geom_edges: 0.0
  beta_seg_edge_from_geom: 0.0
  lambda_main_depth_edge: 0.0

  # === 分解式重构 (依赖无监督假设) ===
  lambda_img: 1.0       # 依然可以使用 RGB 重构
  lambda_alb_tv: 0.1    # 加大平滑约束
  lambda_alb_chroma: 0.05
  lambda_sh_gray: 0.1
  lambda_norm: 0.1      # 法线正则
  lambda_xcov: 0.05